# Лабораторная работа №4: Возможности представления свойств объекта в системе

## Что сделано

В `lab4` реализована мини-библиотека с динамическими свойствами и два потребительских проекта:

- библиотека (`dynamiclib`) не знает пользовательских полей заранее;
- потребитель задает свои части сущности через типизированные ключи;
- потребитель задает свои операции (pipeline) над сущностью;
- есть централизованный реестр ключей с защитой от конфликтов типов.

## Структура

- `dynamiclib/key_registry.py`  
  `TypedKey[T]`, `KeyRegistry`, `GLOBAL_KEY_REGISTRY`, ошибка `KeyConflictError`.
- `dynamiclib/dynamic_context.py`  
  Контекст на словаре (хранение значений по `int id` ключа в обертке).
- `dynamiclib/entity.py`  
  Базовая сущность библиотеки с динамическими свойствами.
- `dynamiclib/pipeline.py`  
  Контекст выполнения операций и pipeline.
- `dynamiclib/library_keys.py`  
  Пример ключа, определенного в библиотеке.
- `consumer_project_a.py`  
  Потребитель №1: свои ключи, создание сущности, операции.
- `consumer_project_b.py`  
  Потребитель №2: демонстрация повторного использования ключа и ошибки при конфликте типов.
- `main.py`  
  Демонстрационный запуск.
- `APPROACH.md`  
  Обоснование подходов и ход мыслей по заданию.

## Как это работает

1. Библиотека предоставляет:

- `Entity` с `DynamicContext`;
- `TypedKey[T]` для типобезопасного доступа к данным;
- глобальный реестр ключей.

2. Потребитель №1:

- регистрирует ключи (`game.health`, `game.armor`, `ctx.trace`, ...);
- заполняет ими сущность;
- конфигурирует pipeline шагов (`apply_damage`, `grant_xp`, `mark_elite`).

3. Потребитель №2:

- пытается использовать тот же ключ `game.health`:
  - с типом `int` — безопасно переиспользуется;
  - с типом `str` — получает исключение `KeyConflictError`.

Это предотвращает ситуацию, когда разные проекты пишут несовместимые данные под одним именем ключа.

## Соответствие заданию

- Динамический контекст, аналогичный библиотечным примерам: выполнено.
- Объяснение, почему FatStruct не подходит библиотеке: в `APPROACH.md`.
- Работа проекта с сущностями из другого проекта: выполнено (библиотека + consumer-проекты).
- Потребитель задает части сущности и операции: выполнено.
- Изоляция библиотеки от потребителя: выполнено (библиотека не зависит от consumer-файлов).
- Централизованный реестр ключей + ошибка при конфликте: выполнено.
- Типизированный ключ через generic: выполнено (`TypedKey[T]`).
- Документация с ходом мыслей: выполнено (`APPROACH.md`).

## Запуск

Из корня проекта:

```powershell
python lab4/main.py
```

Или из папки `lab4`:

```powershell
python main.py
```

